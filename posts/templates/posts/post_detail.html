{% extends 'base.html' %}
{% load static %}
{% load widget_tweaks %}

{% block title %}{{ post.Title }} — MyNewsPortal{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="card post-card p-4">
        <h2>{{ post.title }}</h2>
        <p class="text-muted">
            Опубликовано: {{ post.published_date }} | Категория:
            <a href="{% url 'posts:category_posts' post.category.id %}" class="category-btn btn btn-sm btn-primary">
                {{ post.category.name }}
            </a>
        </p>
        <hr>
        <p>{{ post.description }}</p>
       <a href="{% url 'posts:post_list' %}" class="btn btn-primary back-btn mt-3">Назад к списку постов</a>

    </div>
</div>
<h3>Comments ({{ post.comments.count }})</h3>

<div class="comments-section">
    {% for comment in post.comments.all %}
    <div class="comment mb-2 p-2 border rounded">
        <p><strong>{{ comment.author.username }}:</strong> {{ comment.content }}</p>
        <small class="text-muted">{{ comment.created_at }}</small>

       {% if request.user == comment.author %}
<a href="{% url 'posts:delete_comment' comment.pk %}"
   class="btn btn-sm btn-danger">
   Удалить
</a>
{% endif %}


    </div>
{% empty %}
    <p>No comments yet. Be the first to comment!</p>
{% endfor %}

</div>

{% if user.is_authenticated %}
<form method="POST" action="{% url 'posts:add_comment' post.pk %}" class="mt-3">
    {% csrf_token %}
    <div class="mb-2">
        {{ form.content|add_class:"form-control" }}
    </div>
    <button type="submit" class="btn btn-primary">Add Comment</button>

</form>
 

{% else %}
<p class="mt-3"><a href="{% url 'user_app:login' %}">Login</a> to comment.</p>
{% endif %}

{% endblock %}
